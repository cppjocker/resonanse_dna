dict_hd07 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd71 = {'AA': '0', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd72 = {'AA': '1', 'AC' : '0', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd73 = {'AA': '1', 'AC' : '1', 'AG' : '0', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd74 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd75 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '0', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd76 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '0', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd77 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd78 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '0', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd79 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '0', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd80 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '0', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd81 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '0', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd82 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '0', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd83 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }

dict_hd84 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '0', 'TG' : '1', 'TT' : '1' }

dict_hd85 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '0', 'TT' : '1' }

dict_hd86 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '0' }

dict_hd87 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }


dict_hd55 = {'AA': '0', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd56 = {'AA': '1', 'AC' : '0', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd57 = {'AA': '1', 'AC' : '1', 'AG' : '0', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd58 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '0', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd59 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '0', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd60 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '0', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd61 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '0', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd62 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '0', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd63 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '0', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd64 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '0', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd65 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '0', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd66 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '0', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd67 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '0', 'TC' : '1', 'TG' : '1', 'TT' : '1' }
dict_hd68 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '0', 'TG' : '1', 'TT' : '1' }
dict_hd69 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '0', 'TT' : '1' }
dict_hd70 = {'AA': '1', 'AC' : '1', 'AG' : '1', 'AT' : '1', 'CA' : '1', 'CC' : '1', 'CG' : '1', 'CT' : '1', 'GA' : '1', 'GC' : '1', 'GG' : '1', 'GT' : '1', 'TA' : '1', 'TC' : '1', 'TG' : '1', 'TT' : '0' }


def calc_hydro_letter_by_code(two_letters, code):
    assert(len(two_letters) == 2)

    if two_letters[0] == 'N' or two_letters[1] == 'N':
        left_chain_start_code = 'N'
        return left_chain_start_code

    if code == 'hd_07':
        left_chain_start_code = dict_hd07[two_letters]
    elif code == 'hd_71':
        left_chain_start_code = dict_hd71[two_letters]
    elif code == 'hd_72':
        left_chain_start_code = dict_hd72[two_letters]
    elif code == 'hd_73':
        left_chain_start_code = dict_hd73[two_letters]
    elif code == 'hd_74':
        left_chain_start_code = dict_hd74[two_letters]
    elif code == 'hd_75':
        left_chain_start_code = dict_hd75[two_letters]
    elif code == 'hd_76':
        left_chain_start_code = dict_hd76[two_letters]
    elif code == 'hd_77':
        left_chain_start_code = dict_hd77[two_letters]
    elif code == 'hd_78':
        left_chain_start_code = dict_hd78[two_letters]
    elif code == 'hd_79':
        left_chain_start_code = dict_hd79[two_letters]
    elif code == 'hd_80':
        left_chain_start_code = dict_hd80[two_letters]
    elif code == 'hd_81':
        left_chain_start_code = dict_hd81[two_letters]
    elif code == 'hd_82':
        left_chain_start_code = dict_hd82[two_letters]
    elif code == 'hd_83':
        left_chain_start_code = dict_hd83[two_letters]
    elif code == 'hd_84':
        left_chain_start_code = dict_hd84[two_letters]
    elif code == 'hd_85':
        left_chain_start_code = dict_hd85[two_letters]
    elif code == 'hd_86':
        left_chain_start_code = dict_hd86[two_letters]
    elif code == 'hd_87':
        left_chain_start_code = dict_hd87[two_letters]

    elif code == 'hd_55':
        left_chain_start_code = dict_hd55[two_letters]
    elif code == 'hd_56':
        left_chain_start_code = dict_hd56[two_letters]
    elif code == 'hd_57':
        left_chain_start_code = dict_hd57[two_letters]
    elif code == 'hd_58':
        left_chain_start_code = dict_hd58[two_letters]
    elif code == 'hd_59':
        left_chain_start_code = dict_hd59[two_letters]
    elif code == 'hd_60':
        left_chain_start_code = dict_hd60[two_letters]
    elif code == 'hd_61':
        left_chain_start_code = dict_hd61[two_letters]
    elif code == 'hd_62':
        left_chain_start_code = dict_hd62[two_letters]
    elif code == 'hd_63':
        left_chain_start_code = dict_hd63[two_letters]
    elif code == 'hd_64':
        left_chain_start_code = dict_hd64[two_letters]
    elif code == 'hd_65':
        left_chain_start_code = dict_hd65[two_letters]
    elif code == 'hd_66':
        left_chain_start_code = dict_hd66[two_letters]
    elif code == 'hd_67':
        left_chain_start_code = dict_hd67[two_letters]
    elif code == 'hd_68':
        left_chain_start_code = dict_hd68[two_letters]
    elif code == 'hd_69':
        left_chain_start_code = dict_hd69[two_letters]
    elif code == 'hd_70':
        left_chain_start_code = dict_hd70[two_letters]


    else:
        print(code)
        assert(False)

    return left_chain_start_code

def calc_hydro_letter(two_letters):
    assert(len(two_letters) == 2)

    if two_letters[0] == 'N' or two_letters[1] == 'N':
        left_chain_start_code = 'N'
        return left_chain_start_code

    if two_letters == 'AA':
        left_chain_start_code = 'k'
    elif two_letters == 'AC':
        left_chain_start_code = 'm'
    elif two_letters == 'AG':
        left_chain_start_code = 'm'
    elif two_letters == 'AT':
        left_chain_start_code = 'f'
    elif two_letters == 'CA':
        left_chain_start_code = 'k'
    elif two_letters == 'CC':
        left_chain_start_code = 'm'
    elif two_letters == 'CG':
        left_chain_start_code = 'p'
    elif two_letters == 'CT':
        left_chain_start_code = 'm'
    elif two_letters == 'GA':
        left_chain_start_code = 'k'
    elif two_letters == 'GC':
        left_chain_start_code = 'm'
    elif two_letters == 'GG':
        left_chain_start_code = 'm'
    elif two_letters == 'GT':
        left_chain_start_code = 'm'
    elif two_letters == 'TA':
        left_chain_start_code = 'p'
    elif two_letters == 'TC':
        left_chain_start_code = 'k'
    elif two_letters == 'TG':
        left_chain_start_code = 'k'
    elif two_letters == 'TT':
        left_chain_start_code = 'k'
    else:
        print(two_letters)
        assert(False)

    return left_chain_start_code

def calc_hydro(seq, pos, nucl):
    left_start = seq[pos - 1] + nucl
    len_left = 0

    left_chain_start_letter = calc_hydro_letter(left_start)
    next_hydro_letter = left_chain_start_letter

    if next_hydro_letter in {'k', 'm'}:
        len_left = 1

    seq_orig = nucl
    seq_orig = seq[pos - 1].lower() + seq_orig
    seq_returned = next_hydro_letter.upper()

    for i in range(pos - 1, 0, -1):

        next_two_letters = seq[i - 1] + seq[i]
        next_hydro_letter = calc_hydro_letter(next_two_letters)

        seq_returned = next_hydro_letter + seq_returned
        seq_orig = seq[i - 1].lower() + seq_orig

        if next_hydro_letter not in {'k', 'm'}:
            break

        len_left = len_left + 1

    right_start = nucl + seq[pos + 1]
    len_right = 0

    right_chain_start_letter = calc_hydro_letter(right_start)
    next_hydro_letter = right_chain_start_letter

    if next_hydro_letter in {'k', 'm'}:
        len_right = 1


    seq_returned = seq_returned + next_hydro_letter.upper()
    seq_orig =  seq_orig + seq[pos + 1].lower()

    for i in range(pos + 1, len(seq)):
        next_two_letters = seq[i] + seq[i + 1]
        next_hydro_letter = calc_hydro_letter(next_two_letters)

        seq_returned = seq_returned + next_hydro_letter
        seq_orig =  seq_orig + seq[i + 1].lower()

        if next_hydro_letter not in {'k', 'm'}:
            break

        len_right = len_right + 1

    if left_chain_start_letter not in {'k', 'm'} or right_chain_start_letter not in {'k', 'm'}:
        total_len = max(len_left, len_right)
    else:
        total_len = len_left + len_right

    return total_len, seq_orig, seq_returned



def calc_hydro_by_code(seq, pos, nucl, code):
    left_start = seq[pos - 1] + nucl
    len_left = 0

    left_chain_start_letter = calc_hydro_letter_by_code(left_start, code)
    next_hydro_letter = left_chain_start_letter

    if next_hydro_letter == '1':
        len_left = 1

    seq_orig = nucl
    seq_orig = seq[pos - 1].lower() + seq_orig
    seq_returned = next_hydro_letter.upper()

    for i in range(pos - 1, 0, -1):

        next_two_letters = seq[i - 1] + seq[i]
        next_hydro_letter = calc_hydro_letter_by_code(next_two_letters, code)

        seq_returned = next_hydro_letter + seq_returned
        seq_orig = seq[i - 1].lower() + seq_orig

        if next_hydro_letter != '1':
            break

        len_left = len_left + 1

    right_start = nucl + seq[pos + 1]
    len_right = 0

    right_chain_start_letter = calc_hydro_letter_by_code(right_start, code)
    next_hydro_letter = right_chain_start_letter

    if next_hydro_letter == '1':
        len_right = 1


    seq_returned = seq_returned + next_hydro_letter.upper()
    seq_orig =  seq_orig + seq[pos + 1].lower()

    for i in range(pos + 1, len(seq)):
        next_two_letters = seq[i] + seq[i + 1]
        next_hydro_letter = calc_hydro_letter_by_code(next_two_letters, code)

        seq_returned = seq_returned + next_hydro_letter
        seq_orig =  seq_orig + seq[i + 1].lower()

        if next_hydro_letter != '1':
            break

        len_right = len_right + 1

    if left_chain_start_letter != '1' or right_chain_start_letter != '1':
        total_len = max(len_left, len_right)
    else:
        total_len = len_left + len_right

    return total_len, seq_orig, seq_returned